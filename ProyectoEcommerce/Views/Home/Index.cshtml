@model IEnumerable<ProyectoEcommerce.Models.Product>
@{
    ViewData["Title"] = "Home Page";
}

<main class="main-content">
    <h1 class="section-title">Productos Destacados</h1>

    <div class="products-grid">
        @foreach (var item in Model)
        {
            <div class="product-card">
                <!-- Enlace a Products/Details/{id} usando Anchor Tag Helper -->
                <a asp-controller="Products" asp-action="Details" asp-route-id="@item.Id" class="product-link">
                    <div class="product-image">
                        @{
                            // Decide la URL de la imagen: externa o local
                            string imgSrc = string.Empty;
                            if (!string.IsNullOrEmpty(item.ImageUrl) &&
                            (item.ImageUrl.StartsWith("http://") || item.ImageUrl.StartsWith("https://")))
                            {
                                imgSrc = item.ImageUrl; // URL externa
                            }
                            else if (!string.IsNullOrEmpty(item.ImageUrl))
                            {
                                // Normaliza rutas locales: acepta "images/..." "/images/..." o "~/images/..."
                                var localPath = item.ImageUrl.StartsWith("~")
                                ? item.ImageUrl
                                : (item.ImageUrl.StartsWith("/") ? "~" + item.ImageUrl : "~/" + item.ImageUrl.TrimStart('/'));
                                imgSrc = Url.Content(localPath);
                            }
                            else
                            {
                                imgSrc = Url.Content("~/images/products/placeholder.jpg"); // placeholder
                            }
                        }

                        @* Si la fuente es externa no podemos usar asp-append-version. Para local, sí. *@
                        @if (imgSrc.StartsWith("http"))
                        {
                            <img src="@imgSrc" alt="@item.Name" class="card-img" />
                        }
                        else
                        {
                            <img src="@imgSrc" alt="@item.Name" class="card-img" asp-append-version="true" />
                        }

                        <div class="product-badge @(item.Available ? "available" : "unavailable")">
                            @(item.Available ? "Disponible" : "Agotado")
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 class="product-name">@item.Name</h3>
                        @* Si tienes categoría como propiedad, muéstrala. Si no, omítelo. *@
                        @* <p class="product-category">@item.Category</p> *@
                        <p class="product-availability">
                            <span class="status-indicator @(item.Available ? "" : "unavailable")"></span>
                            @(item.Available ? $"En stock ({item.Stock} unidades)" : "Sin stock")
                        </p>
                        <div class="product-price">@item.Price.ToString("C")</div>
                    </div>
                </a>
            </div>
        }
    </div>
</main>

<a href="#" class="whatsapp-btn" title="Contactar por WhatsApp">W</a>
