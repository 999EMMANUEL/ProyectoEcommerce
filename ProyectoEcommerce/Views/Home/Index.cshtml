@model IEnumerable<ProyectoEcommerce.Models.Product>
@{
    ViewData["Title"] = "Home Page";
}
@section Styles {
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
}
<main class="main-content">
    <h1 class="section-title">Productos Destacados</h1>

    <div class="products-grid">
        @foreach (var item in Model)
        {
            <div class="product-card">
                <!-- Enlace a Products/Details/{id} usando Anchor Tag Helper -->
                <a asp-controller="Products" asp-action="Details" asp-route-id="@item.Id" class="product-link">
                    <div class="product-image">
                        @{
                            // Decide la URL de la imagen: externa o local
                            string imgSrc = string.Empty;
                            if (!string.IsNullOrEmpty(item.ImageUrl) &&
                                (item.ImageUrl.StartsWith("http://") || item.ImageUrl.StartsWith("https://")))
                            {
                                imgSrc = item.ImageUrl; // URL externa
                            }
                            else if (!string.IsNullOrEmpty(item.ImageUrl))
                            {
                                // Normaliza rutas locales: acepta "images/..." "/images/..." o "~/images/..."
                                var localPath = item.ImageUrl.StartsWith("~")
                                    ? item.ImageUrl
                                    : (item.ImageUrl.StartsWith("/") ? "~" + item.ImageUrl : "~/" + item.ImageUrl.TrimStart('/'));
                                imgSrc = Url.Content(localPath);
                            }
                            else
                            {
                                imgSrc = Url.Content("~/images/products/placeholder.jpg"); // placeholder
                            }
                        }

                        @* Si la fuente es externa no podemos usar asp-append-version. Para local, sí. *@
                        @if (imgSrc.StartsWith("http"))
                        {
                            <img src="@imgSrc" alt="@item.Name" class="card-img" />
                        }
                        else
                        {
                            <img src="@imgSrc" alt="@item.Name" class="card-img" asp-append-version="true" />
                        }

                        <div class="product-badge @(item.Available ? "available" : "unavailable")">
                            @(item.Available ? "Disponible" : "Agotado")
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 class="product-name">@item.Name</h3>
                        @* Si tienes categoría como propiedad, muéstrala. Si no, omítelo. *@
                        @* <p class="product-category">@item.Category</p> *@
                        <p class="product-availability">
                            <span class="status-indicator @(item.Available ? "" : "unavailable")"></span>
                            @(item.Available ? $"En stock ({item.Stock} unidades)" : "Sin stock")
                        </p>
                        <div class="product-price">@item.Price.ToString("C")</div>
                    </div>
                </a>
            </div>
        }
    </div>

</main>

<img src="~/images/Logos/Whats.png" class="whatsapp-btn" title="Contactar por WhatsApp"></img>

<li class="nav-item">
    <a class="nav-link text-dark" asp-area="" asp-controller="Products" asp-action="Index">Productos</a>
</li>

<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d583.836237941427!2d-85.44659042062092!3d10.134533464034956!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f9fb0ad9493f9cf%3A0x12f243e7463b8ae2!2sUniversidad%20Nacional%2C%20150%2C%20Provincia%20de%20Guanacaste%2C%20Nicoya!5e0!3m2!1ses-419!2scr!4v1757747295459!5m2!1ses-419!2scr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>